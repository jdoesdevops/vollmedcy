name: Cypress Tests

on:
  push:
    branches:
      - jdoesdevops-test

jobs:
  build-images:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
    steps:
      - name: Setup Node and NPM
        uses: actions/setup-node@v4
        with: 
          node-version: 20
      - name: Checkout
        uses: actions/checkout@v4
      
      - name: Install
        run: npm install
      
      - name: Checkout Server
        uses: actions/checkout@v4
        with:
          path: server

      - name: Install Server
        run: |
          cd server
          npm install
          npm start &
        working-directory: server

      - name: Checkout Web
        uses: actions/checkout@v4
        with:
          path: web
      
      - name: Install Web
        run: |
          cd web
          npm install
          npm start &
        working-directory: web
      
      - name: Configurar VariÃ¡vel de Ambiente
        run: echo "DB_ENV=${{ secrets.DB_ENV }}" > server/.env

      - name: Cypress Run Tests Server & Web
        uses: cypress-io/github-action@v6
        with:
          wait-on: 'http://localhost:3000, http://localhost:8080'
    env:
      browser: chrome
      DEBUG: '@cypress/github-action'
      GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      
      # - name: Cypress Run Tests Server
      #   uses: cypress-io/github-action@v6
      #   with:
      #     config: baseUrl=http://localhost:8080
      #     spec: cypress/e2e/server/**.cy.js
      #     wait-on: 'http://localhost:3000, http://localhost:8080'
      #   env:
      #     DEBUG: '@cypress/github-action'
          
      # - name: Cypress Run Tests Web
      #   uses: cypress-io/github-action@v6
      #   with:
      #     config: baseUrl=http://localhost:3000
      #     spec: cypress/e2e/web/**.cy.js
      #     wait-on: 'http://localhost:3000, http://localhost:8080'
      #   env:
      #     browser: chrome
      #     DEBUG: '@cypress/github-action'
      #     GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
















# name: Cypress Tests

# on:
#   push:
#     branches:
#       - jdoesdevops-test

# jobs:
#   server-tests:
#     runs-on: ubuntu-latest
#     strategy:
#       fail-fast: false
#     continue-on-error: true
#     steps:
#       - name: Config ipv4
#         run: export NODE_OPTIONS=--dns-result-order=ipv4first
#       - name: Checkout
#         uses: actions/checkout@v4
#       - uses: actions/setup-node@v4
#         with:
#           node-version: 18
#       - name: Install Dependencies
#         run: |
#           npm prune
#           npm install
      # - name: Cypress Start Server
      #   uses: cypress-io/github-action@v6
      #   with:
      #     start: npm start
      #     working-directory: server
      #   env:
      #     DEBUG: '@cypress/github-action'
  
#   web-tests:
#     runs-on: ubuntu-latest
#     strategy:
#       fail-fast: false
#     continue-on-error: true
#     needs: server-tests
#     steps:
#       - name: Config ipv4
#         run: export NODE_OPTIONS=--dns-result-order=ipv4first
#       - name: Checkout
#         uses: actions/checkout@v4
#       - uses: actions/setup-node@v4
#         with:
#           node-version: 18
#       - name: Install Dependencies
#         run: |
#           npm prune
#           npm install
#       - name: Cypress Start Web
#         uses: cypress-io/github-action@v6
#         with:
#           start: npm start
#           working-directory: web
#           browser: chrome
#         env:
#           DEBUG: '@cypress/github-action'
