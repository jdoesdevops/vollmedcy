name: Cypress Tests

on:
  push:
    branches:
      - jdoesdevops-test

jobs:
  build-images:
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
    steps:
      - name: Setup Node and NPM
        uses: actions/setup-node@v4
        with: 
          node-version: 20
      - name: Checkout
        uses: actions/checkout@v4

      - name: Start Servers
        uses: adambirds/docker-compose-action@v1.3.0
        with:
          compose-file: "./docker-compose.yml"
      
      - name: Cypress Run Tests Server
        uses: cypress-io/github-action@v6
        with:
          config: baseUrl=http://127.0.0.1:8080
          spec: cypress/e2e/server/**.cy.js
          working-directory: .
        env:
          DEBUG: '@cypress/github-action'
          email: 'clinica@gmail.com'
          senha: '4321'
          password: '4321'
          api_login: 'http://127.0.0.1:8080/auth/login'
          api_clinica: 'http://127.0.0.1:8080/clinica'
          api_especialista: 'http://127.0.0.1:8080/especialista'
          
      - name: Cypress Run Tests Web
        uses: cypress-io/github-action@v6
        with:
          start: npm run start-web
          config: baseUrl=http://localhost:3000
          spec: cypress/e2e/web/**.cy.js
          working-directory: .
          browser: chrome
        env:
          DEBUG: '@cypress/github-action'
















# name: Cypress Tests

# on:
#   push:
#     branches:
#       - jdoesdevops-test

# jobs:
#   server-tests:
#     runs-on: ubuntu-latest
#     strategy:
#       fail-fast: false
#     continue-on-error: true
#     steps:
#       - name: Config ipv4
#         run: export NODE_OPTIONS=--dns-result-order=ipv4first
#       - name: Checkout
#         uses: actions/checkout@v4
#       - uses: actions/setup-node@v4
#         with:
#           node-version: 18
#       - name: Install Dependencies
#         run: |
#           npm prune
#           npm install
      # - name: Cypress Start Server
      #   uses: cypress-io/github-action@v6
      #   with:
      #     start: npm start
      #     working-directory: server
      #   env:
      #     DEBUG: '@cypress/github-action'
  
#   web-tests:
#     runs-on: ubuntu-latest
#     strategy:
#       fail-fast: false
#     continue-on-error: true
#     needs: server-tests
#     steps:
#       - name: Config ipv4
#         run: export NODE_OPTIONS=--dns-result-order=ipv4first
#       - name: Checkout
#         uses: actions/checkout@v4
#       - uses: actions/setup-node@v4
#         with:
#           node-version: 18
#       - name: Install Dependencies
#         run: |
#           npm prune
#           npm install
#       - name: Cypress Start Web
#         uses: cypress-io/github-action@v6
#         with:
#           start: npm start
#           working-directory: web
#           browser: chrome
#         env:
#           DEBUG: '@cypress/github-action'
